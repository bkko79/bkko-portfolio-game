# 沢山のゲームタイトルを「子供に伝える」アプリケーション　仕様書（補足説明資料付き）

## 紹介

「ゲームとは何か?」という質問には、色々な答えがあると思いますが、小さい頃の私には灰色のカセットでした。

青い単色の背景にヨッシーと一緒に笑っているマリオしか知らなかった私に、ショーウインドーの中にある沢山のグレーのカセットには、そのゲームを代表するイメージとタイトルが書かれていて、それを見てどんなゲームなのかを想像したりしました。

「そのゲームをしたい」と言う気持ちと共に「カセットが欲しい」な欲求があり、私にとってカセットはいつの間にかゲームを象徴する存在になったと思います。

あの自分の背景から企画が始まり、今回のアプリケーションを制作する事になりました。

子供専用より、子供も大人も一緒に楽しむコンテンツが私が今回のポートフォリオで目指した方向です。

## 環境デプロイーマニュアル

この環境はreactのcreate-react-appとyarnを使って構築しました。(npmも使えます。)

下記のコマンドの中で一つ選んで必要なnode_modulesを該当ディレクトリーに設置させてください。

```shell
yarn install
or
npm install
```

設置が終わったらすぐ開発環境の実行ができます：

```shell
yarn start
or
npm start
```

後、画面に出力されるURLで接続できます。

```shell
Compiled successfully!

You can now view todo-list in the browser.

  Local:            http://localhost:3000
  On Your Network:  http://192.168.11.10:3000

Note that the development build is not optimized.
To create a production build, use yarn build.
```

## 企画

任天堂スイッチは、ゲームカードを機器に入れて実行する、36年前のファミコンと同じインタラクションを提供します。陳列棚にある沢山のゲームカセットは、子供も大人もワクワクさせる魔力があります。タイトル、メイン画像の二つだけでも、カセットは沢山の想像力を刺激する素晴らしい媒体です。

私はエンジニアとして、現実で可能なインタラクションをウェブに具現すると言う概念が好きです。スマートフォンの紙を押すようなタッチインタフェースがブラウザの生態系を変えたように、現実を繊細に複製することで初めてオーラを持つようになるのが魅力だと思います。

![初期企画](https://github.com/bkko79/bkko-portfolio-game/blob/master/docs/20200319_152721.jpg "初期企画の写真")

上の写真は一番初期の企画案です。

ウェブは情報を共有するメディアとして素晴らしい手段ですが、印刷物と同様に限界を持っています。 解像度に比べてあふれる内容はオーバーキルになり、少なすぎる内容は面倒なインタラクションを強要することになります。

先ず、「一画面でゲーム一つを見物する。しかし、次のゲームまで1秒以内に持ち越えられなければならない」というのが最初の前提でした。速いアニメーションのカルーセルは、本棚に挿されたゲームソフトを見る速度で探索を可能にします。Drag出来るカルーセルも素晴らしいUXですが、各ゲーム紹介を１枚のページにきれいに伝えようとすると、テレビのチャンネルを回すようなクリックアクションがより効果的です。

その次は、ページを飾る要素です。任天堂ストアに登録されたゲームのスクリーンショットは最低6枚で、これを全部使う事にしました。スクリーンショットはタイトルと共に最もゲームをうまく説明する要素なので、選択したゲームのスクリーンショットが自然に背景で回転するように配置しました。

過去のTVCMがそうであったように映像は非常に強力ですが、ウェブの映像は情報伝達の速度が比較的に遅い媒体であり、視聴時に他のインタラクションが不可能になる制限があります。その為、スクリーンショットを見て興味を持った人なら、簡単に映像が見られるように右下にプレーヤーを配置しました。

ゲームにはスローガンが必ず存在します。どんなテーマ意識があるのか、主人公が乗り越えていく婦警について簡単な説明が想像力につながります。 映像と一緒に好きな読者がいつでも楽に読めるように右上にテキストを配置しました。

レスポンシブ対応もしています。ほとんどのスマートフォンは縦長なため、カルーセルを真ん中に配置し、スクリーンショットをキャラセルの後ろの背景画面に、ゲームカードをクリックして映像またはテキスト情報を照会できるようにし、インタラクションを二箇所に分けました。

最後はデータの拡張及びコードのリサイクルのため、ゲームデータをjson形式で制作しました。現在は任天堂ストアから任意のゲーム6つを選びましたが、ゲーム追加や全く別セットのゲームリストに置き換えて、同じUIを使えるようにviewを分離しました。

## ファイルツリー

このアプリケーションはクラスで構築されています。

```shell
.
├── README.md
├── docs
│   └── manual-jp.md
├── package.json
├── public
│   ├── favicon.ico
│   └── index.html
├── src
│   ├── App.js
│   ├── Carousel.js
│   ├── Info.js
│   ├── Stripe.js
│   ├── imgs
│   ├── index.js
│   ├── initial-datas.js
│   └── sass
│       ├── app.scss
│       ├── carousel.scss
│       ├── info.scss
│       ├── stripe.scss
│       └── transition.css
├── yarn-error.log
└── yarn.lock

5 directories, 18 files
```

### 重要ファイル

#### 1. index.js

最初にreactDOMをRenderするファイルで、stateを管理する関数を持つ上位コンポネントです。

#### 2. App.js

メインコンポネントで、下位コンポネントを結ぶWrapperです。背景に必要なカラーセットやゲーム情報をStateに管理する最上位classで、そのstate管理関数を持って、下位コンポネントに伝達する役割です。

少しだけ特別な機能とは、ゲームが変わる時に出力される画像を最初のページロードの時強制にpreloadするコードがfooter以下に設置しました。surge.shの無料CDNにある遅延に対してゲーム変更の時もっとスムーズにアニメーションを出力する為に追加しました。

#### 3. Carousel.js

長い歴史のjQueryのカルーセルモジュールslickのReact版を使い、このアプリケーションの核心機能を構築しました。verticalモードを使い上下に動く、カスタマイズされた矢印を出力しています。

このコンポネントは、真っ白のゲームカード画像の上に、3dでtransformされたゲームメインイメージとそのシリアルナンバーが出て、カルーセルの回転と同時に内臓callback関数が上位stateをアップデートする形です。

何より、回転するオブジェクトを最小化して、アニメーションがブラウザーに大きい負荷を出さないように設計されていることが大事です。

#### 4. Stripe.js

ゲームソフトには必ず代表カラーがありますので、背景にそれを表現して各ゲーム別に違うページを見る印象を受けるように作りました。

先のCarousel.jsにはColorThiefと言うモジュールがあり、ゲームが変わる時、メイン画像を分析して代表カラー七つをrgb形式で取得、上位コンポネントのstateに反映します。上位stateの変化を検知したらStripe.jsはすぐ各カラー別のストライプ背景を再生成します。

もっと生彩を満ちる為に、各ストライプブロックはopacity付きで、ランダムのyポジションと高さをもらいます。その結果各ブロックが重ねた場合はその間のミックスカラーが出るし、ゲームを変わる時は毎回新しいストライプがフェイドインされます。

colorthiefは必ずブラウザーに画像がロードされた後に動くモジュールで、DOMツリーから画像を取得して、カラーを分析します。つまり画像がロードされた後にイベントを追加する非同期処理で動きます。（もちろん画像がロードされた後は直ぐ取得します。）

#### 5. Info.js

カルーセルがゲームリストに集中できるように、情報出力担当としてInfo.jsを別のコンポネントに作りました。Appのstateにあるゲーム情報が変わった時、jsonで保存されているゲームデータを読んでスクリーンショット、タイトル、テキスト、動画などを画面に出力します。

各情報はカルーセルのアニメーションに合わせてcssアニメーションが出ます。react-transition-groupと言うモジュールを使って、state変化を辺地したらtransition.cssに保存されているアニメーション付きのクラス名が自然に指定した各グループに追加され、アニメーションがブラウザーに出します。

アニメーションや情報の配置が沢山ありまして、レスポンシブ対応が一番多いコンポネントの一つでした。出来る限り同じscssファイルにブラウザの幅と高さ別のcssを分離して、レスポンシブなスタイルを下に追加しました。

#### 6. initial-datas.js

ゲームリストを呼ぶバックエンドAPIがあると想定して、そのコール結果を任意で作ったデータセットです。jsonの形式に作ると、nodeではすぐimportしてオブジェクトとして使えますので、簡単なモックアップ制作に容易です。

全情報は公式任天堂ストアーからダウンロード出来るエレメントです。もしもっと多い量の情報を出せるゲームあっても、例外処理より再活用できるコードの構築を優先する為に、今回のポートフォリオには現実的に収集できる情報量の限界を想定しました。

#### 7. ./sass/*.scss

node-sassモジュールを使うと簡単にscssファイルをインポートしてcssと同じように使えます。画像の幅や高さ、後そのwrapperの高さを計算する為にscssの変数などを使かったのでscssをスタイルシートの基本フォーマットとして使いました。

基本的にはモジュール別にscssを分離する作業方法が好きですので、今回もコンポネントと同じ名前のscssファイルを作って、各コンポネント別のスタイルシートを作りました。

### 重要モジュール

#### 1. create-react-app

nodeでテスト環境構築に必要なモジュールを管理するパッケージです。デフォルトのファイルを削除してもっと簡単な構造に改造しました。

#### 2. node-sass

node環境でsassコンパイルを支援するツールで、本来はスタイルシート生成に利用される道具です。今回はscssのフォーマットをcssにコンパイルしなくて直ぐimportできるように使いました。

#### 3. react-slick

jQueryで一番有名なカルーセルモジュール「slick」をreactにポーティングしたバージョンです。ES6を支援しますので、今回の作業に問題なくで使えました。

#### 4. colorthief

DOMにロードされた画像オブジェクトの色を分析するjsライブラリーのnode版です。DOM選択で簡単に操作できますが、imagemagickやpngquantなどの画像分析ではなく、ブラウザーにレンダリングされたイメージを使う道具なので、必ずイベント処理がひつようになります。今回もゲームのタイトルイメージのロードにイベント処理を入れて対応しました。

#### 5. react-icons

react用svgアイコンライブラリーです。必要なアイコン名だけをimportすることで容量を節約する事ができます。

#### 6. react-player

youtubeや他の動画プラットフォームにカスタマイズされたvideoタグを自分のアプリケーションに使えるようにする便利なライブラリーで、様々なコントローラーAPIを支援します。今回のyoutube動画エレメントに使いました。

#### 7. react-transition-group

イベント発生の該当DOMに自動でクラスを導入したり、timeoutに合わせて例外処理するモジュールです。TODOデータの削除及び追加する時、アニメーション用CSSが入っているクラス名を入れます。各イベント別にDOMを探したりする不便なプロセスがテンプレート化されています。
